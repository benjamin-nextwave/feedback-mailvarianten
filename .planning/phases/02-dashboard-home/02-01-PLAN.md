---
phase: 02-dashboard-home
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/utils.ts
  - src/app/dashboard/page.tsx
  - src/app/dashboard/loading.tsx
  - src/app/dashboard/_components/forms-table.tsx
  - src/app/dashboard/_components/copy-link-button.tsx
  - src/app/dashboard/_components/table-skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard home page displays all forms in a table with Dutch column headers"
    - "Each form row shows Klantnaam, Aangemaakt op, Status badge, Deelbare link, and Acties"
    - "Status badges show correct colors (amber for Openstaand, green for Ingeleverd)"
    - "Shareable public URLs are copyable with visual feedback (Gekopieerd)"
    - "Empty state displays when no forms exist with appropriate Dutch message"
    - "Loading skeleton displays instantly while data is being fetched"
  artifacts:
    - path: "src/app/dashboard/page.tsx"
      provides: "Server Component dashboard page with Supabase data fetching"
      contains: "await createClient"
    - path: "src/app/dashboard/_components/forms-table.tsx"
      provides: "Table rendering all forms with Dutch column headers"
      contains: "Klantnaam"
    - path: "src/app/dashboard/_components/copy-link-button.tsx"
      provides: "Client Component for copy-to-clipboard with feedback"
      contains: "use client"
    - path: "src/app/dashboard/loading.tsx"
      provides: "Instant loading skeleton for dashboard"
      min_lines: 10
    - path: "src/app/dashboard/_components/table-skeleton.tsx"
      provides: "Table-shaped skeleton matching forms table layout"
      min_lines: 10
  key_links:
    - from: "src/app/dashboard/page.tsx"
      to: "supabase.from('forms')"
      via: "Server Component async data fetch"
      pattern: "supabase.*from.*forms"
    - from: "src/app/dashboard/page.tsx"
      to: "src/app/dashboard/_components/forms-table.tsx"
      via: "passes forms array as prop"
      pattern: "FormsTable.*forms"
    - from: "src/app/dashboard/_components/forms-table.tsx"
      to: "src/components/status-badge.tsx"
      via: "renders StatusBadge for each form row"
      pattern: "StatusBadge.*status"
    - from: "src/app/dashboard/_components/forms-table.tsx"
      to: "src/app/dashboard/_components/copy-link-button.tsx"
      via: "renders CopyLinkButton with generated public URL"
      pattern: "CopyLinkButton.*url"
    - from: "src/app/dashboard/page.tsx"
      to: "src/components/empty-state.tsx"
      via: "renders EmptyState when forms array is empty"
      pattern: "EmptyState"
---

<objective>
Build the complete dashboard home page that lists all feedback forms from Supabase in a table with Dutch column headers, status badges, copyable shareable links, an empty state, and a loading skeleton.

Purpose: This is the agency's primary view — the first thing they see when accessing the dashboard. It needs to show all forms at a glance with key information (client name, date, status, shareable link) so the agency can quickly find and share feedback forms with clients.

Output: Working dashboard page at /dashboard that fetches real data from Supabase and renders it in a professional table with all interactive elements.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-home/02-RESEARCH.md

# Phase 1 artifacts needed (types, components, Supabase client)
@src/types/database.types.ts
@src/lib/supabase/server.ts
@src/components/status-badge.tsx
@src/components/page-header.tsx
@src/components/empty-state.tsx
@src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui Table and Skeleton components, add utility functions</name>
  <files>
    src/lib/utils.ts
    src/components/ui/table.tsx
    src/components/ui/skeleton.tsx
  </files>
  <action>
1. Install shadcn/ui Table and Skeleton components:
   ```
   npx shadcn@latest add table skeleton
   ```
   This creates src/components/ui/table.tsx and src/components/ui/skeleton.tsx.

2. Add two utility functions to `src/lib/utils.ts` (append to existing file, keep the existing `cn` function):

   a) `formatDate(dateString: string): string` — Formats a date string for Dutch locale using `new Intl.DateTimeFormat('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' }).format(new Date(dateString))`. Returns strings like "10 feb 2026".

   b) `generatePublicUrl(slug: string): string` — Generates an absolute public URL for a form. Uses `process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000'` as the base, returns `${baseUrl}/feedback/${slug}`. The path is `/feedback/[slug]` (matching the Phase 5 public form route). Note: NEXT_PUBLIC_SITE_URL does NOT need to be added to .env.example yet — it falls back to localhost for development.

Do NOT create a separate utils file. Append to the existing `src/lib/utils.ts` which already has the `cn` function.
  </action>
  <verify>
1. Confirm shadcn/ui components installed: check that `src/components/ui/table.tsx` and `src/components/ui/skeleton.tsx` exist
2. Confirm `src/lib/utils.ts` exports `cn`, `formatDate`, and `generatePublicUrl`
3. Run `npx tsc --noEmit` to verify no TypeScript errors
  </verify>
  <done>
- Table and Skeleton shadcn/ui components installed at src/components/ui/table.tsx and src/components/ui/skeleton.tsx
- formatDate function returns Dutch-formatted dates (e.g., "10 feb 2026")
- generatePublicUrl function returns absolute URL with /feedback/ path
- TypeScript compiles with zero errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dashboard page with forms table, copy button, loading skeleton, and empty state</name>
  <files>
    src/app/dashboard/page.tsx
    src/app/dashboard/loading.tsx
    src/app/dashboard/_components/forms-table.tsx
    src/app/dashboard/_components/copy-link-button.tsx
    src/app/dashboard/_components/table-skeleton.tsx
  </files>
  <action>
Create 5 files that together form the complete dashboard home page:

**1. `src/app/dashboard/page.tsx`** — Server Component (async, NO 'use client')
- Import `createClient` from `@/lib/supabase/server` (CRITICAL: `const supabase = await createClient()` — must await)
- Query forms table: `supabase.from('forms').select('id, client_name, slug, status, created_at').order('created_at', { ascending: false })`
- Handle error: if error, `throw new Error('Formulieren konden niet worden geladen')` (triggers error boundary)
- Import and render `PageHeader` with title "Formulieren" and description "Beheer je feedback formulieren"
- If forms is empty/null, render `EmptyState` with title "Geen formulieren" and description "Er zijn nog geen feedback formulieren aangemaakt." — no action button yet (form creation is Phase 4)
- If forms exist, render `FormsTable` passing the forms array
- Type the forms data using the `Form` type from `@/types/database.types`

**2. `src/app/dashboard/_components/forms-table.tsx`** — Server Component (NO 'use client')
- Accept `forms: Form[]` prop (import Form type from `@/types/database.types`)
- Use shadcn/ui Table components (Table, TableHeader, TableRow, TableHead, TableBody, TableCell)
- Dutch column headers in this exact order: Klantnaam, Aangemaakt op, Status, Deelbare link, Acties
- For each form row:
  - Klantnaam: `form.client_name` with `font-medium` class
  - Aangemaakt op: call `formatDate(form.created_at)` from `@/lib/utils`
  - Status: render `<StatusBadge status={form.status} />` from `@/components/status-badge`
  - Deelbare link: render `<CopyLinkButton url={generatePublicUrl(form.slug)} />` using `generatePublicUrl` from `@/lib/utils`
  - Acties: render a `<Link href={/dashboard/${form.id}}>` styled as a ghost Button with "Bekijken" text and an Eye icon from lucide-react. This links to the form detail page (Phase 3). Use Next.js `Link` component for client-side navigation.
- Wrap table in a Card component for consistent styling with subtle shadow

**3. `src/app/dashboard/_components/copy-link-button.tsx`** — Client Component (MUST have 'use client' directive)
- Accept `url: string` prop
- State: `copied` boolean, defaults to false
- onClick handler: `await navigator.clipboard.writeText(url)`, set copied to true, setTimeout 2 seconds to reset to false. Wrap in try/catch (log error on failure).
- Render shadcn/ui Button with variant="ghost" and size="sm":
  - Default state: Copy icon (from lucide-react) + text "Kopieer link"
  - Copied state: Check icon (from lucide-react) + text "Gekopieerd!" with text-success class for green color feedback
- Add `className="gap-2"` to Button for icon spacing

**4. `src/app/dashboard/_components/table-skeleton.tsx`** — Server Component
- Create a skeleton that visually matches the forms table layout
- Use shadcn/ui Skeleton component
- Render 5 skeleton rows, each with 5 cells matching the table column widths
- Wrap in the same Card component as the real table for visual consistency
- Include a skeleton for the PageHeader area (title + description)

**5. `src/app/dashboard/loading.tsx`** — Next.js loading convention
- Import and render `TableSkeleton` from `./_components/table-skeleton`
- This is all it needs — Next.js automatically wraps the page in a Suspense boundary using this file

Important implementation notes:
- Do NOT add 'use client' to any file except copy-link-button.tsx
- The forms-table.tsx is a Server Component that can directly import and render the Client Component CopyLinkButton (React handles the boundary)
- Use the `Form` type from database.types.ts for type safety — do NOT use `any`
- The Acties column "Bekijken" link goes to `/dashboard/${form.id}` — this page does not exist yet (Phase 3) but the link should be in place
  </action>
  <verify>
1. Run `npx tsc --noEmit` — zero TypeScript errors
2. Run `npm run build` — build succeeds with no errors
3. Verify file structure exists:
   - src/app/dashboard/page.tsx
   - src/app/dashboard/loading.tsx
   - src/app/dashboard/_components/forms-table.tsx
   - src/app/dashboard/_components/copy-link-button.tsx
   - src/app/dashboard/_components/table-skeleton.tsx
4. Verify 'use client' directive is ONLY in copy-link-button.tsx (not in other files)
5. Verify Dutch text: grep for "Klantnaam", "Aangemaakt op", "Deelbare link", "Acties", "Geen formulieren", "Kopieer link", "Gekopieerd", "Bekijken"
  </verify>
  <done>
- Dashboard page at /dashboard fetches forms from Supabase and renders them in a table
- Table has 5 Dutch columns: Klantnaam, Aangemaakt op, Status, Deelbare link, Acties
- StatusBadge shows Openstaand (amber) or Ingeleverd (green) for each form
- CopyLinkButton copies absolute public URL to clipboard with "Gekopieerd!" feedback
- EmptyState shows "Geen formulieren" when no forms exist
- Loading skeleton appears instantly while data loads
- Acties column has "Bekijken" link pointing to /dashboard/[id] (Phase 3 route)
- Build succeeds with zero TypeScript errors
  </done>
</task>

</tasks>

<verification>
Phase 2 verification checks (run after all tasks complete):

1. **Build check:** `npm run build` passes with no errors
2. **TypeScript check:** `npx tsc --noEmit` passes
3. **File existence:** All 8 files exist (2 shadcn components + 1 modified utils + 5 dashboard files)
4. **Dutch text:** All user-facing text is in Dutch (Klantnaam, Aangemaakt op, Status, Deelbare link, Acties, Kopieer link, Gekopieerd, Geen formulieren, Bekijken, Formulieren)
5. **Server/Client boundary:** Only copy-link-button.tsx has 'use client' directive
6. **Type safety:** Form type from database.types.ts used throughout (no `any`)
7. **Data flow:** page.tsx fetches -> passes to FormsTable -> FormsTable renders rows with StatusBadge + CopyLinkButton
8. **Empty state:** Conditional rendering when forms array is empty
</verification>

<success_criteria>
- Navigating to /dashboard shows either the forms table (with data) or an empty state (without data)
- Table renders with correct Dutch column headers in exact order: Klantnaam, Aangemaakt op, Status, Deelbare link, Acties
- StatusBadge correctly maps 'active' to amber "Openstaand" and 'completed' to green "Ingeleverd"
- Copy button copies absolute URL (http://localhost:3000/feedback/[slug]) and shows "Gekopieerd!" for 2 seconds
- Loading skeleton displays during data fetch
- Application builds and compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-home/02-01-SUMMARY.md`
</output>
