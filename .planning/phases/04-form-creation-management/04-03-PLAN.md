---
phase: 04-form-creation-management
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/forms/DeleteFormDialog.tsx
  - src/app/dashboard/_components/forms-table.tsx
  - src/app/dashboard/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Delete button appears for each form in the dashboard"
    - "Clicking delete opens Dutch confirmation modal: 'Weet je zeker dat je dit formulier wilt verwijderen?'"
    - "Confirming deletion removes form and redirects to dashboard home"
    - "Cancelling closes the modal without deleting"
  artifacts:
    - path: "src/components/forms/DeleteFormDialog.tsx"
      provides: "Delete confirmation dialog with Dutch text and loading state"
      min_lines: 40
    - path: "src/app/dashboard/_components/forms-table.tsx"
      provides: "Updated forms table with delete action column"
    - path: "src/app/dashboard/[id]/page.tsx"
      provides: "Updated form detail page with delete button"
  key_links:
    - from: "src/components/forms/DeleteFormDialog.tsx"
      to: "src/lib/actions/form-actions.ts"
      via: "deleteFormAction call on confirmation"
      pattern: "deleteFormAction"
    - from: "src/app/dashboard/_components/forms-table.tsx"
      to: "src/components/forms/DeleteFormDialog.tsx"
      via: "DeleteFormDialog rendered in each row"
      pattern: "DeleteFormDialog"
    - from: "src/app/dashboard/[id]/page.tsx"
      to: "src/components/forms/DeleteFormDialog.tsx"
      via: "DeleteFormDialog in detail page header"
      pattern: "DeleteFormDialog"
---

<objective>
Create the delete form confirmation dialog and integrate it into both the dashboard forms table and the form detail page.

Purpose: Agency needs to clean up forms they no longer need. The confirmation modal prevents accidental deletion of forms that may contain client feedback.
Output: DeleteFormDialog component integrated into dashboard table rows and form detail page.
</objective>

<execution_context>
@C:\Users\bstei\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bstei\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-form-creation-management/04-RESEARCH.md
@.planning/phases/04-form-creation-management/04-01-SUMMARY.md
@src/lib/actions/form-actions.ts
@src/app/dashboard/_components/forms-table.tsx
@src/app/dashboard/[id]/page.tsx
@src/components/ui/alert-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeleteFormDialog component</name>
  <files>src/components/forms/DeleteFormDialog.tsx</files>
  <action>
Create a Client Component for the delete confirmation dialog.

Mark `'use client'`.

**Props:** `{ formId: string, formName: string, trigger?: React.ReactNode }`
- formId: UUID of the form to delete
- formName: client name, displayed in modal for clarity
- trigger: optional custom trigger element (defaults to a destructive button)

**Implementation:**
- Use AlertDialog from shadcn (not Dialog — AlertDialog is semantically correct for destructive confirmations and has better accessibility: traps focus, requires explicit action)
- State: `isDeleting` boolean for loading
- `handleDelete`: set isDeleting true, call `deleteFormAction(formId)` from @/lib/actions/form-actions. The server action handles redirect, so no need to handle success in client. On error, set isDeleting false.

**UI structure:**
```
<AlertDialog>
  <AlertDialogTrigger asChild>
    {trigger || (
      <Button variant="destructive" size="sm">
        <Trash2 className="mr-2 h-4 w-4" />
        Verwijderen
      </Button>
    )}
  </AlertDialogTrigger>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>
        Weet je zeker dat je dit formulier wilt verwijderen?
      </AlertDialogTitle>
      <AlertDialogDescription>
        Het formulier voor "{formName}" wordt permanent verwijderd, inclusief alle varianten en feedback. Deze actie kan niet ongedaan worden gemaakt.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel disabled={isDeleting}>
        Annuleren
      </AlertDialogCancel>
      <AlertDialogAction
        onClick={handleDelete}
        disabled={isDeleting}
        className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
      >
        {isDeleting ? 'Verwijderen...' : 'Verwijderen'}
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

Note: AlertDialogAction by default closes the dialog on click. Since deleteFormAction triggers a redirect, the user won't see the dialog close — they'll be redirected to dashboard. The `disabled={isDeleting}` prevents double-clicks during the redirect.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm component compiles.
Check that AlertDialog (not Dialog) is used.
Check that deleteFormAction is imported from @/lib/actions/form-actions.
Check Dutch text: "Weet je zeker dat je dit formulier wilt verwijderen?" in title.
  </verify>
  <done>DeleteFormDialog component renders AlertDialog with Dutch confirmation text, shows form name in description, has Annuleren/Verwijderen buttons, handles loading state, and calls deleteFormAction on confirmation.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate DeleteFormDialog into dashboard table and detail page</name>
  <files>src/app/dashboard/_components/forms-table.tsx, src/app/dashboard/[id]/page.tsx</files>
  <action>
**File 1: Update src/app/dashboard/_components/forms-table.tsx**

Read the current file first to understand its structure.

The forms-table currently has columns: Klantnaam, Aangemaakt op, Status, Deelbare link, Acties (with Bekijken link).

Modifications:
1. Import `DeleteFormDialog` from `@/components/forms/DeleteFormDialog`
2. In the Acties column (last column), add DeleteFormDialog next to the existing "Bekijken" link
3. Pass `formId={form.id}` and `formName={form.client_name}` to DeleteFormDialog
4. For the table trigger button, use a compact version: `trigger={<Button variant="ghost" size="sm"><Trash2 className="h-4 w-4" /></Button>}` — ghost variant to keep the table clean
5. Wrap the Bekijken link and DeleteFormDialog in a flex row with gap-2

IMPORTANT: Since FormsTable may currently be a Server Component, check first. If it is, it needs to either:
- Remain a Server Component and render DeleteFormDialog as a Client Component within it (since DeleteFormDialog is already 'use client', this is fine — Server Components can render Client Components)
- OR be converted to Client Component if needed

The forms-table file likely does NOT need 'use client' since DeleteFormDialog handles its own client state. Server Components can import and render Client Components.

**File 2: Update src/app/dashboard/[id]/page.tsx**

Read the current file first.

Add delete button to the form detail page:
1. Import `DeleteFormDialog` from `@/components/forms/DeleteFormDialog`
2. Add DeleteFormDialog in the page header area or metadata section, using the full button trigger (not compact):
   - Place it near the top of the page, perhaps in the header actions area or next to the back button
   - Pass `formId={form.id}` and `formName={form.client_name}`
3. Since this page is a Server Component, DeleteFormDialog (a Client Component) can be rendered directly within it.

Position the delete button logically — the form detail page likely has a header with the client name. Place the delete action there, perhaps alongside or below the metadata card.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm both files compile.
Run `npm run build` to verify pages build correctly.
Check that forms-table.tsx imports and renders DeleteFormDialog.
Check that [id]/page.tsx imports and renders DeleteFormDialog.
  </verify>
  <done>
- Forms table has delete button (ghost icon) in each row's Acties column next to Bekijken link
- Form detail page has delete button with full "Verwijderen" label
- Both integrate DeleteFormDialog which shows Dutch confirmation modal
- Confirming deletion calls deleteFormAction, which deletes and redirects to dashboard
- TypeScript compiles and Next.js builds
  </done>
</task>

</tasks>

<verification>
1. Dashboard forms table shows delete icon button in each row
2. Clicking delete icon opens AlertDialog with "Weet je zeker dat je dit formulier wilt verwijderen?"
3. Modal shows form client name in description
4. "Annuleren" closes modal without deleting
5. "Verwijderen" deletes form and redirects to dashboard
6. Form detail page (/dashboard/[id]) has "Verwijderen" button
7. Delete from detail page also shows confirmation and redirects after deletion
8. `npm run build` succeeds
</verification>

<success_criteria>
- DeleteFormDialog component exists with Dutch confirmation text
- Delete action available from both dashboard table AND form detail page
- Confirmation modal prevents accidental deletion
- Successful deletion removes form from database (CASCADE removes variants + feedback)
- User is redirected to /dashboard after deletion
- Dashboard list updates immediately (revalidatePath works)
</success_criteria>

<output>
After completion, create `.planning/phases/04-form-creation-management/04-03-SUMMARY.md`
</output>
